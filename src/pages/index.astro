---
import GithubCalendar from '@/components/bento/GithubCalendar.tsx'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { SOCIAL_LINKS } from '@/consts'
import Layout from '@/layouts/Layout.astro'
import { getAllPosts } from '@/lib/data-utils'
import { cn } from '@/lib/utils'
import { Icon } from 'astro-icon/components'

const latestPost = await getAllPosts().then((posts) => posts.at(0))
---

<Layout class="px-2">
  <PageHead slot="head" title="Home" />
  <section
    class={cn(
      'mx-auto grid min-w-xs sm:has-[[data-trigger]:hover]:*:first:[&_[data-overlay]]:opacity-0',
      'max-w-sm grid-cols-1 [grid-template-areas:"a""b""e""f""i"]',
      'sm:max-w-2xl sm:grid-cols-2 sm:[grid-template-areas:"a_a""b_e""f_f""i_i"]',
      'lg:max-w-5xl lg:grid-cols-3 lg:[grid-template-areas:"a_a_b""e_f_f""i_i_i"]',
    )}
  >
    <!-- About Section -->
    <div class="aspect-[3/4] p-2 [grid-area:a] sm:aspect-[2/1]">
      <div class="bg-muted size-full border relative overflow-hidden">
        <div class="flex p-6 h-full flex-col justify-center">
          <div class="space-y-4 sm:w-2/3">
            <p class="text-foreground/80 block text-lg font-medium text-pretty">
              Hey, I&rsquo;m Yifan! I&rsquo;m a student at <Link
                href="https://www.scut.edu.cn/"
                external
                class="text-foreground decoration-muted-foreground hover:decoration-foreground font-medium break-words underline underline-offset-[3px] transition-colors"
                >SCUT</Link
              >.
            </p>
            <p class="text-foreground/80 block text-sm text-pretty">
              I'm passionate about technology, design, and music. 
              Currently exploring web development and enjoying the bedroom pop vibes of <Link href="https://www.icyball.com/" external class="font-medium underline">icyball</Link>.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Blog Intro -->
    <div class="aspect-square p-2 [grid-area:b]">
      <div data-trigger class="bg-muted size-full border relative overflow-hidden group">
        <div class="size-full flex items-center justify-center p-6 text-center">
           <p class="text-foreground/80 text-sm text-pretty">
              This blog is my personal space to share thoughts, projects, and experiences.
              <br/><br/>
              Welcome to my corner of the web!
            </p>
        </div>
      </div>
    </div>

    <!-- Latest Post -->
    <div class="aspect-[6/5] p-2 [grid-area:e] sm:aspect-square">
      <div data-trigger class="bg-muted size-full border relative group/blog">
         <div class="p-4 size-full flex flex-col justify-between">
            <div class="text-sm text-muted-foreground">Latest Post</div>
            {
              latestPost ? (
                <div class="flex-1 flex flex-col justify-end gap-2">
                   <Link href={`/blog/${latestPost.id}`} class="font-medium text-lg hover:underline">
                      {latestPost.data.title}
                   </Link>
                   <p class="text-xs text-muted-foreground">{latestPost.data.description}</p>
                </div>
              ) : (
                <div class="flex-1 flex items-center justify-center text-muted-foreground">
                  No posts yet
                </div>
              )
            }
         </div>
          {
            latestPost && (
              <Link
                href={`/blog/${latestPost.id}`}
                title={`Read latest blog post: ${latestPost.data.title}`}
                aria-label={`Read latest blog post: ${latestPost.data.title}`}
                class="bg-border/50 text-primary ring-ring group/blog-link absolute end-0 bottom-0 m-3 rounded-full p-3 transition-[box-shadow] duration-300 hover:ring-2 focus-visible:ring-2"
              >
                <Icon
                  name="lucide:move-up-right"
                  class="transition-transform duration-300 group-hover/blog-link:rotate-12"
                  size={16}
                />
              </Link>
            )
          }
      </div>
    </div>

    <!-- GitHub Calendar -->
    <div class="aspect-square p-2 [grid-area:f] sm:aspect-[2/1]">
      <div data-trigger class="bg-muted relative size-full border">
        <div class="flex size-full items-center justify-center p-4">
          <GithubCalendar username="sudo-yf" client:load />
        </div>
      </div>
    </div>

    <!-- GitHub Link -->
    <div class="aspect-square p-2 [grid-area:i] sm:aspect-auto">
      <div class="bg-muted size-full border">
        <div
          class="group/github relative flex size-full items-center justify-center"
        >
          <Icon
            name="mdi:github"
            class="text-primary absolute size-1/2 sm:size-24 opacity-20 group-hover/github:opacity-100 transition-opacity"
            aria-hidden="true"
          />
          <Link
            href={SOCIAL_LINKS.find((link) => link.label === 'GitHub')?.href ||
              '#'}
            title="Visit my GitHub profile"
            aria-label="Visit my GitHub profile"
            external
            class="bg-border/50 text-primary ring-ring group/github-link absolute end-0 bottom-0 m-3 rounded-full p-3 transition-[box-shadow] duration-300 hover:ring-2 focus-visible:ring-2"
          >
            <Icon
              name="lucide:move-up-right"
              class="transition-transform duration-300 group-hover/github-link:rotate-12"
              size={16}
            />
          </Link>
          <span class="font-medium">GitHub</span>
        </div>
      </div>
    </div>

  </section>
</Layout>
